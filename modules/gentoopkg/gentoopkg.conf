# SPDX-FileCopyrightText: no
# SPDX-License-Identifier: CC0-1.0
#
# Configuration for the gentoopkg module - Gentoo-specific package management
# This module extends the standard packages functionality with Gentoo-specific
# features like USE flags, package.accept_keywords, and world updates.
---

# Skip package installation/removal failures instead of aborting Calamares.
# When true, treats all "install" operations as "try_install" and
# all "remove" operations as "try_remove", meaning package
# installation/removal failures won't cause Calamares to fail.
# This is useful when some packages might not be available in
# certain repositories or USE flag configurations.
skip_unavailable: false

# Skip the whole module when there is no internet connection.
skip_if_no_internet: false

# Run "emerge-webrsync -q" to update the Portage tree before installing packages.
update_db: true

# Method to use for Portage tree sync when update_db is true.
# Options:
#  - "webrsync": Use emerge-webrsync (faster, uses snapshots, fallback to sync if fails)
#  - "sync": Use emerge --sync (slower but more reliable for problematic networks)  
#  - "none": Skip syncing entirely (use existing Portage tree)
sync_method: webrsync

# Run system update after package operations.
# If gentoo_world_update is true, runs "emerge --update --deep --newuse @world"
# If false, runs "emerge --update @system"
update_system: false

# Perform a full world update after package operations.
# This ensures all dependencies are properly updated with new USE flags.
gentoo_world_update: false

# List of packages that should be added to package.accept_keywords
# to allow installation of testing/unstable versions.
# Example: ["dev-lang/rust", "sys-devel/llvm"]
accept_keywords: []

# Package operations - same format as the standard packages module
# Supported operations:
#  - install: Install packages (critical - will fail if package unavailable, unless skip_unavailable=true)
#  - try_install: Install packages (non-critical - will continue if package unavailable)
#  - remove: Remove packages (critical - will fail if package unavailable, unless skip_unavailable=true)  
#  - try_remove: Remove packages (non-critical - will continue if package unavailable)
#  - localInstall: Install local binary packages
#
# Package names support Gentoo-specific syntax:
#  - Category/package: "dev-lang/python"
#  - Specific versions: "=dev-lang/python-3.11*"
#  - USE flags: "dev-lang/python[sqlite,ssl]"
#  - Slots: "dev-lang/python:3.11"
#
# Localization with LOCALE substitution is supported:
#  - "app-office/libreoffice-l10n-${LOCALE}" will be substituted based on system locale
#  - If locale is "en", packages with LOCALE in the name are skipped
#
operations:
  # Example: Install essential packages
  - install:
    - app-editors/vim
    - sys-process/htop
    - net-misc/wget
    - app-admin/sudo
  
  # Example: Remove unwanted packages (use try_remove to ignore if not present)
  - try_remove:
    - games-misc/fortune-mod
    
  # Example: Install packages that might not be available everywhere
  - try_install:
    - app-office/libreoffice-l10n-${LOCALE}
    - media-libs/mesa[vulkan]  # might fail if vulkan USE not available

  # Example: Install with pre/post scripts
  - install:
    - package: www-servers/apache
      pre-script: /bin/systemctl stop apache2 || true
      post-script: /bin/systemctl enable apache2
